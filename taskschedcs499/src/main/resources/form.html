<!--In need of a makeover to match search page
Also, need to figure out the best way to enable CSV file upload support-->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width-device-width, initial-scale-1.0">
	<title>Appointment Form</title>
</head>
<body>
	<h1>Appointment Details Form:</h1>
		
		<p style="color:purple;">Legal Eagle Eye: Your Local Executors</p>

	<form id="appointmentForm" method="post">
		<label for="appoint">Appointment:</label>
		<input type="text" id="appoint" name="appoint" required><br><br>
			
		<label for="name">Name:</label>
		<input type="text" id="name" name="name" required><br><br>
			
		<label for="dsp">Description:</label>
		<textarea id="dsp" name="dsp" required></textarea><br><br>
			
		<label for="datetime">Date and Time:</label>
		<input type="datetime-local" id="datetime" name="datetime" required><br><br>
			
		<button type="submit">Submit</button>
	</form>
	
	<script>
		document.getElementById("appointmentForm").addEventListener("submit", async function(event) {
			event.preventDefault();
			
			const formData = new FormData(event.target);
			const jsonData = Object.fromEntries(formData.entries());
			
			if (jsonData.datetime) {
				try{
					jsonData.datetime = new Date(jsonData.datetime).toISOString();
				} catch (error) {
				console.error("Invalid date", jsonData.datetime, error);
				alert("Let's go again.")
				return;
				}
			}
			console.log("Submitting JSON:", jsonData);
			
			const response = await fetch("/search", {
				method: "POST",
				headers: {"Content-Type": "application/json"},
				body: JSON.stringify(jsonData)
			});
			
			console.log("Server Response:", response)
			
			if (response.ok){
				alert("Appointment Made!");
				event.target.reset();
			} else {
				alert("Failed: Reschedule?");
			}
		});
		</script>
</body>
</html>